<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MASRI — Matrix Sriwijaya</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Inter", "system-ui", "Segoe UI", "Helvetica", "Arial"] },
          colors: {
            night: "#0f172a",
            ink: "#0b1020",
            soft: "#e2e8f0",
            primary: "#6366f1",
            secondary: "#22d3ee",
            glass: "rgba(255,255,255,0.08)",
          },
          boxShadow: {
            glass: "0 10px 30px rgba(2, 6, 23, 0.35)",
          },
        },
      },
    };
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- Export Helpers: SheetJS + jsPDF + AutoTable -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <style>
    /* Fancy scrollbars */
    ::-webkit-scrollbar{ width:10px; height:10px }
    ::-webkit-scrollbar-thumb{ background:linear-gradient(180deg,#6366f1,#22d3ee); border-radius:999px }
    ::-webkit-scrollbar-track{ background:transparent }
    /* Input currency caret alignment */
    input.currency { text-align:right }
    .card { backdrop-filter: blur(12px); background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04)); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-ink via-[#0a162e] to-night text-white font-sans">
  <!-- Header -->
  <header class="sticky top-0 z-40 backdrop-blur bg-black/20 border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-2xl bg-gradient-to-br from-primary to-secondary grid place-items-center shadow-glass">
          <span class="font-extrabold">M</span>
        </div>
        <div>
          <h1 class="text-xl sm:text-2xl font-extrabold tracking-tight">MASRI</h1>
          <p class="text-xs text-white/60 -mt-0.5">Matrix Sriwijaya</p>
        </div>
      </div>
      <div class="hidden md:flex items-center gap-2">
        <button id="btnExportXLSX" class="px-4 py-2 rounded-2xl bg-primary/90 hover:bg-primary transition shadow-glass text-sm font-semibold">Export Excel</button>
        <button id="btnExportPDF" class="px-4 py-2 rounded-2xl bg-secondary/90 hover:bg-secondary transition shadow-glass text-sm font-semibold text-black">Export PDF</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-4 sm:p-6 space-y-6">
    <!-- Project Info (top-right on export) -->
    <section class="card shadow-glass rounded-3xl p-4 sm:p-6 border border-white/10">
      <div class="grid md:grid-cols-4 gap-4 items-end">
        <div class="md:col-span-2">
          <label class="text-sm text-white/70">Nama Project</label>
          <input id="projectName" type="text" placeholder="Masukkan nama project" class="mt-1 w-full bg-white/5 border border-white/10 rounded-2xl px-4 h-11 focus:outline-none focus:ring-2 focus:ring-primary/60"/>
        </div>
        <div class="md:col-span-2">
          <label class="text-sm text-white/70">Nama Perusahaan</label>
          <input id="companyName" type="text" placeholder="Masukkan nama perusahaan" class="mt-1 w-full bg-white/5 border border-white/10 rounded-2xl px-4 h-11 focus:outline-none focus:ring-2 focus:ring-primary/60"/>
        </div>
      </div>
    </section>

    <!-- Services Table -->
    <section class="card shadow-glass rounded-3xl p-4 sm:p-6 border border-white/10">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg sm:text-xl font-bold">Tabel Layanan</h2>
        <button id="btnAddService" class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/10 text-sm">+ Tambah Layanan</button>
      </div>

      <div class="overflow-x-auto">
        <table id="serviceTable" class="w-full text-sm">
          <thead class="bg-white/5">
            <tr class="text-left">
              <th class="p-3">No</th>
              <th class="p-3">Service</th>
              <th class="p-3">Bandwidth</th>
              <th class="p-3">Contract (bulan)</th>
          <th class="p-3">Monthly Fee (IDR)</th>
          <th class="p-3">Total Fee (Auto)</th>
    
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot class="bg-white/5">
            <tr>
              <td colspan="5" class="p-3 font-semibold">Total Yearly Fee</td>
              <td class="p-3 font-bold text-right" id="totalYearly">Rp 0</td>
            </tr>
            <tr>
              <td colspan="5" class="p-3 font-semibold">Subtotal</td>
              <td class="p-3 font-bold text-right" id="subtotal">Rp 0</td>
            </tr>
            <tr>
              <td colspan="5" class="p-3 font-semibold">Tax</td>
              <td class="p-3 text-right"><span class="mr-2">11%</span><span id="tax">Rp 0</span></td>
            </tr>
            <tr>
              <td colspan="5" class="p-3 font-semibold">Total</td>
              <td class="p-3 font-bold text-right" id="total">Rp 0</td>
            </tr>
            <tr>
              <td colspan="5" class="p-3 font-semibold">Materai</td>
              <td class="p-3 text-right" id="materai">Rp 10.000</td>
            </tr>
            <tr>
              <td colspan="5" class="p-3 font-extrabold text-base">Grand Total</td>
              <td class="p-3 font-extrabold text-base text-right" id="grandTotal">Rp 10.000</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </section>

    <!-- Hardware Table -->
    <section class="card shadow-glass rounded-3xl p-4 sm:p-6 border border-white/10">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg sm:text-xl font-bold">Hardware Cost Tabel</h2>
        <button id="btnAddHW" class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/10 text-sm">+ Tambah Hardware</button>
      </div>

      <div class="overflow-x-auto">
        <table id="hardwareTable" class="w-full text-sm">
          <thead class="bg-white/5">
            <tr class="text-left">
              <th class="p-3">No</th>
              <th class="p-3">Hardware</th>
              <th class="p-3">Type</th>
              <th class="p-3">Qty</th>
              <th class="p-3">Price (IDR)</th>
              <th class="p-3">Total Price (Auto)</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot class="bg-white/5">
            <tr>
              <td colspan="5" class="p-3 font-semibold">Total HW Cost</td>
              <td class="p-3 font-bold text-right" id="totalHW">Rp 0</td>
            </tr>
            <tr>
              <td colspan="5" class="p-3 font-semibold">Cost % (Total HW / Subtotal)</td>
              <td class="p-3 font-bold text-right" id="costPct">0%</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </section>

    <!-- Sticky Export on mobile -->
    <div class="md:hidden fixed bottom-4 right-4 flex gap-2">
      <button id="btnExportXLSX_mb" class="px-3 py-2 rounded-2xl bg-primary/90 hover:bg-primary text-sm font-semibold shadow-glass">Excel</button>
      <button id="btnExportPDF_mb" class="px-3 py-2 rounded-2xl bg-secondary/90 hover:bg-secondary text-black text-sm font-semibold shadow-glass">PDF</button>
    </div>
  </main>

  <script>
    // --- Data Definitions ---
    const CONTRACT_OPTIONS = [6, 12, 24, 36];
    
    const SERVICES = {
      "Biznet Dedicated Internet": ["80 Mbps","100 Mbps","120 Mbps","160 Mbps","200 Mbps","240 Mbps","280 Mbps","320 Mbps","360 Mbps","400 Mbps","500 Mbps","600 Mbps","700 Mbps","800 Mbps","900 Mbps","1 Gbps","1.2 Gbps","1.6 Gbps","2 Gbps","3 Gbps","4 Gbps","10 Gbps"],
      "Biznet Hospitalitynet": ["80 Mbps","100 Mbps","120 Mbps","160 Mbps","200 Mbps","240 Mbps","280 Mbps","320 Mbps","360 Mbps","400 Mbps","500 Mbps","600 Mbps","700 Mbps","800 Mbps","900 Mbps","1 Gbps","1.2 Gbps","1.6 Gbps"],
      "Biznet Dedicated Educationnet": ["100 Mbps","120 Mbps","160 Mbps","200 Mbps","240 Mbps","280 Mbps","320 Mbps","360 Mbps","400 Mbps","500 Mbps","600 Mbps","700 Mbps","800 Mbps","900 Mbps","1 Gbps","1.2 Gbps","1.6 Gbps","2 Gbps","3 Gbps","4 Gbps","10 Gbps"],
      "Biznet Dedicated Healthnet": ["100 Mbps","120 Mbps","160 Mbps","200 Mbps","240 Mbps","280 Mbps","320 Mbps","360 Mbps","400 Mbps","500 Mbps","600 Mbps","700 Mbps","800 Mbps","900 Mbps","1 Gbps","1.2 Gbps","1.6 Gbps","2 Gbps","3 Gbps","4 Gbps","10 Gbps"],
      "Biznet Datacomm": ["2 Mbps","5 Mbps","10 Mbps","20 Mbps","25 Mbps","50 Mbps","75 Mbps","100 Mbps","250 Mbps","500 Mbps","1 Gbps","2.5 Gbps","5 Gbps","10 Gbps"]
    };

    const HW_OPTIONS = ["Router","Access Point","POE Switch","Switch Unmanage","Switch Manage","Cable","Installation","Electronic Stuff","Connector","Adaptor","Kickback","Travel","Training"];

    // --- Helpers ---
    const fmtIDR = (n) => {
      if (isNaN(n) || n === null) return "Rp 0";
      return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(n).replace(",00","");
    }
    const parseIDR = (str) => {
      if (!str) return 0;
      return Number(String(str).replace(/[^0-9.-]/g, '')) || 0;
    }

    function makeSelect(options, {placeholder="Pilih…", cls=""}={}){
      const sel = document.createElement('select');
      sel.className = `w-full h-10 bg-white/5 border border-white/10 rounded-xl px-3 ${cls}`;
      const opt0 = document.createElement('option');
      opt0.value = ""; opt0.textContent = placeholder; sel.appendChild(opt0);
      options.forEach(o=>{ const op=document.createElement('option'); op.value=o; op.textContent=o; sel.appendChild(op); });
      return sel;
    }

    function makeQtySelect(){ return makeSelect(Array.from({length:36}, (_,i)=> i+1).map(String), {placeholder:"Qty"}); }

    function renumberRows(tbody){
      [...tbody.querySelectorAll('tr')].forEach((tr,i)=> tr.querySelector('td').textContent = i+1);
    }

    // --- Build Service Table ---
    const serviceTbody = document.querySelector('#serviceTable tbody');

    function addServiceRow(){
      const tr = document.createElement('tr');
      tr.className = 'border-b border-white/10';

      // No
      const tdNo = document.createElement('td'); tdNo.className='p-3 w-10'; tdNo.textContent=''; tr.appendChild(tdNo);

      // Service
      const tdService = document.createElement('td'); tdService.className='p-3 min-w-[240px]';
      const selService = makeSelect(Object.keys(SERVICES), {placeholder:'Pilih Service'});
      tdService.appendChild(selService); tr.appendChild(tdService);

      // Bandwidth
      const tdBW = document.createElement('td'); tdBW.className='p-3 min-w-[220px]';
      const selBW = makeSelect([], {placeholder:'Pilih Bandwidth'});
      tdBW.appendChild(selBW); tr.appendChild(tdBW);

      // Contract
      const tdContract = document.createElement('td'); tdContract.className='p-3 w-32';
      const selContract = makeSelect(CONTRACT_OPTIONS.map(String), {placeholder:'Contract'});
      tdContract.appendChild(selContract); tr.appendChild(tdContract);

      // Monthly Fee
      const tdMonthly = document.createElement('td'); tdMonthly.className='p-3 min-w-[180px]';
      const iMonthly = document.createElement('input'); iMonthly.type='text'; iMonthly.placeholder='0'; iMonthly.className='w-full h-10 bg-white/5 border border-white/10 rounded-xl px-3'; iMonthly.inputMode = 'numeric';
      iMonthly.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/[^0-9]/g, '');
      });
      tdMonthly.appendChild(iMonthly); tr.appendChild(tdMonthly);

      // Total Fee (auto)
      const tdTotal = document.createElement('td'); tdTotal.className='p-3 text-right min-w-[160px]';
      tdTotal.textContent = fmtIDR(0); tr.appendChild(tdTotal);

      // Delete button
      const tdDelete = document.createElement('td'); tdDelete.className='p-3 w-12';
      const btnDelete = document.createElement('button');
      btnDelete.innerHTML = '<i data-lucide="trash-2" class="w-4 h-4"></i>';
      btnDelete.className = 'text-red-400 hover:text-red-300 transition-colors';
      btnDelete.addEventListener('click', () => {
        if (confirm('Yakin nih mau dihapus?')) {
          tr.remove();
          renumberRows(serviceTbody);
          recalcAll();
        }
      });
      tdDelete.appendChild(btnDelete); tr.appendChild(tdDelete);

      // Events
      selService.addEventListener('change', () => {
        const opts = SERVICES[selService.value] || [];
        selBW.innerHTML = '';
        selBW.appendChild(new Option('Pilih Bandwidth',''));
        opts.forEach(o => selBW.appendChild(new Option(o,o)));
        recalcAll();
      });
      [selBW, selContract, iMonthly].forEach(el => el.addEventListener('input', recalcAll));

      serviceTbody.appendChild(tr);
      renumberRows(serviceTbody);
      lucide.createIcons();
    }

    document.getElementById('btnAddService').addEventListener('click', addServiceRow);

    // --- Build Hardware Table ---
    const hwTbody = document.querySelector('#hardwareTable tbody');
    function addHWRow(){
      const tr = document.createElement('tr');
      tr.className = 'border-b border-white/10';

      const tdNo = document.createElement('td'); tdNo.className='p-3 w-10'; tr.appendChild(tdNo);
      const tdHW = document.createElement('td'); tdHW.className='p-3 min-w-[200px]';
      const selHW = makeSelect(HW_OPTIONS, {placeholder:'Pilih Hardware'}); tdHW.appendChild(selHW); tr.appendChild(tdHW);
      const tdType = document.createElement('td'); tdType.className='p-3 min-w-[220px]';
      const iType = document.createElement('input'); iType.type='text'; iType.placeholder='Type (alfanumerik)'; iType.className='w-full h-10 bg-white/5 border border-white/10 rounded-xl px-3'; tdType.appendChild(iType); tr.appendChild(tdType);
      const tdQty = document.createElement('td'); tdQty.className='p-3 w-24'; const sQty = makeQtySelect(); tdQty.appendChild(sQty); tr.appendChild(tdQty);
      const tdPrice = document.createElement('td'); tdPrice.className='p-3 min-w-[160px]';
      const iPrice = document.createElement('input'); iPrice.type='text'; iPrice.placeholder='Rp 0'; iPrice.className='currency w-full h-10 bg-white/5 border border-white/10 rounded-xl px-3'; tdPrice.appendChild(iPrice); tr.appendChild(tdPrice);
      const tdTotal = document.createElement('td'); tdTotal.className='p-3 text-right min-w-[160px]'; tdTotal.textContent = fmtIDR(0); tr.appendChild(tdTotal);
      
      // Delete button
      const tdDelete = document.createElement('td'); tdDelete.className='p-3 w-12';
      const btnDelete = document.createElement('button');
      btnDelete.innerHTML = '<i data-lucide="trash-2" class="w-4 h-4"></i>';
      btnDelete.className = 'text-red-400 hover:text-red-300 transition-colors';
      btnDelete.addEventListener('click', () => {
        if (confirm('Yakin nih mau dihapus?')) {
          tr.remove();
          renumberRows(hwTbody);
          recalcAll();
        }
      });
      tdDelete.appendChild(btnDelete); tr.appendChild(tdDelete);

      [sQty, iPrice].forEach(el => el.addEventListener('input', recalcAll));
      hwTbody.appendChild(tr);
      renumberRows(hwTbody);
      lucide.createIcons();
    }
    document.getElementById('btnAddHW').addEventListener('click', addHWRow);

    // Currency masking - REMOVED to allow direct number input
    // document.addEventListener('input', (e)=>{
    //   if(e.target.matches('input.currency')){
    //     const pos = e.target.selectionStart;
    //     const raw = parseIDR(e.target.value);
    //     e.target.value = fmtIDR(raw);
    //     e.target.setSelectionRange(pos, pos);
    //   }
    // });

    // --- Calculations ---
    function recalcAll(){
      // Services
      let totalYearly = 0;
      serviceTbody.querySelectorAll('tr').forEach(tr => {
        const contract = parseInt(tr.querySelector('td:nth-child(4) select')?.value || '12');
        const monthly = parseIDR(tr.querySelector('td:nth-child(5) input')?.value);
        const total = monthly * contract;
        tr.querySelector('td:nth-child(6)').textContent = fmtIDR(total);
        totalYearly += total;
      });
      document.getElementById('totalYearly').textContent = fmtIDR(totalYearly);
      document.getElementById('subtotal').textContent = fmtIDR(totalYearly);

      // Taxes & totals
      const tax = Math.round(totalYearly * 0.11);
      const total = totalYearly + tax;
      const materai = 10000;
      const grand = total + materai;
      document.getElementById('tax').textContent = fmtIDR(tax);
      document.getElementById('total').textContent = fmtIDR(total);
      document.getElementById('grandTotal').textContent = fmtIDR(grand);

      // Hardware
      let totalHW = 0;
      hwTbody.querySelectorAll('tr').forEach(tr => {
        const qty = parseInt(tr.querySelector('td:nth-child(4) select')?.value || '0');
        const price = parseIDR(tr.querySelector('td:nth-child(5) input')?.value);
        const tp = qty * price;
        tr.querySelector('td:nth-child(6)').textContent = fmtIDR(tp);
        totalHW += tp;
      });
      document.getElementById('totalHW').textContent = fmtIDR(totalHW);
      const pct = totalYearly ? (totalHW / totalYearly * 100) : 0;
      document.getElementById('costPct').textContent = `${pct.toFixed(2)}%`;
    }

    // Initial setup
    addServiceRow();
    addHWRow();

    // Export functions
    function exportExcel(){
      const wb = XLSX.utils.book_new();
      const proj = document.getElementById('projectName').value || '';
      const comp = document.getElementById('companyName').value || '';

      const svcRows = [["No","Service","Bandwidth","Contract (bulan)","Monthly Fee (IDR)","Total Fee (Auto)"]];
      serviceTbody.querySelectorAll('tr').forEach((tr,i)=>{
        svcRows.push([
          i+1,
          tr.querySelector('td:nth-child(2) select')?.value || '',
          tr.querySelector('td:nth-child(3) select')?.value || '',
          tr.querySelector('td:nth-child(4) select')?.value || '',
          parseIDR(tr.querySelector('td:nth-child(5) input')?.value),
          parseIDR(tr.querySelector('td:nth-child(6)')?.textContent)
        ]);
      });
      svcRows.push([]);
      svcRows.push(["Total Yearly Fee", null, null, null, null, parseIDR(document.getElementById('totalYearly').textContent)]);
      svcRows.push(["Subtotal", null, null, null, null, parseIDR(document.getElementById('subtotal').textContent)]);
      svcRows.push(["Tax 11%", null, null, null, null, parseIDR(document.getElementById('tax').textContent)]);
      svcRows.push(["Total", null, null, null, null, parseIDR(document.getElementById('total').textContent)]);
      svcRows.push(["Materai", null, null, null, null, 10000]);
      svcRows.push(["Grand Total", null, null, null, null, parseIDR(document.getElementById('grandTotal').textContent)]);
      svcRows.unshift(["Project:", proj, "Company:", comp]);
      const ws1 = XLSX.utils.aoa_to_sheet(svcRows);
      XLSX.utils.book_append_sheet(wb, ws1, 'Services');

      const hwRows = [["No","Hardware","Type","Qty","Price (IDR)","Total Price (Auto)"]];
      hwTbody.querySelectorAll('tr').forEach((tr,i)=>{
        hwRows.push([
          i+1,
          tr.querySelector('td:nth-child(2) select')?.value || '',
          tr.querySelector('td:nth-child(3) input')?.value || '',
          tr.querySelector('td:nth-child(4) select')?.value || '',
          parseIDR(tr.querySelector('td:nth-child(5) input')?.value),
          parseIDR(tr.querySelector('td:nth-child(6)')?.textContent)
        ]);
      });
      hwRows.push([]);
      hwRows.push(["Total HW Cost", null, null, null, null, parseIDR(document.getElementById('totalHW').textContent)]);
      hwRows.push(["Cost % (Total HW / Subtotal)", null, null, null, null, document.getElementById('costPct').textContent]);
      const ws2 = XLSX.utils.aoa_to_sheet(hwRows);
      XLSX.utils.book_append_sheet(wb, ws2, 'Hardware');

      XLSX.writeFile(wb, `MARKITUNG_${(proj||'Project').replace(/\s+/g,'_')}.xlsx`);
    }

    function exportPDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });
      const marginX = 36, marginY = 42;

      const proj = document.getElementById('projectName').value || '';
      const comp = document.getElementById('companyName').value || '';

      doc.setFont('helvetica','bold');
      doc.setFontSize(16);
      doc.text('MARKITUNG — Auto Procurement Calculator', marginX, marginY);
      doc.setFont('helvetica','normal');
      doc.setFontSize(10);
      const headerRight = [`Project: ${proj}`, `Company: ${comp}`, `Tanggal: ${new Date().toLocaleDateString('id-ID')}`];
      headerRight.forEach((t,i)=> doc.text(t, 420, marginY + i*14));

      const svcHead = [["No","Service","Bandwidth","Contract (bulan)","Monthly Fee (IDR)","Total Fee (Auto)"]];
      const svcBody = [];
      serviceTbody.querySelectorAll('tr').forEach((tr,i)=>{
        svcBody.push([
          i+1,
          tr.querySelector('td:nth-child(2) select')?.value || '',
          tr.querySelector('td:nth-child(3) select')?.value || '',
          tr.querySelector('td:nth-child(4) select')?.value || '',
          parseIDR(tr.querySelector('td:nth-child(5) input')?.value).toLocaleString('id-ID'),
          parseIDR(tr.querySelector('td:nth-child(6)')?.textContent).toLocaleString('id-ID')
        ]);
      });
      doc.autoTable({ startY: marginY+28, head: svcHead, body: svcBody, styles:{fontSize:9}, theme:'grid', headStyles:{fillColor:[99,102,241]} });

      const hwHead = [["No","Hardware","Type","Qty","Price (IDR)","Total Price (Auto)"]];
      const hwBody = [];
      hwTbody.querySelectorAll('tr').forEach((tr,i)=>{
        hwBody.push([
          i+1,
          tr.querySelector('td:nth-child(2) select')?.value || '',
          tr.querySelector('td:nth-child(3) input')?.value || '',
          tr.querySelector('td:nth-child(4) select')?.value || '',
          parseIDR(tr.querySelector('td:nth-child(5) input')?.value).toLocaleString('id-ID'),
          parseIDR(tr.querySelector('td:nth-child(6)')?.textContent).toLocaleString('id-ID')
        ]);
      });
      doc.autoTable({ startY: doc.lastAutoTable.finalY + 20, head: hwHead, body: hwBody, styles:{fontSize:9}, theme:'grid', headStyles:{fillColor:[34,211,238]} });

      doc.save(`MARKITUNG_${(proj||'Project').replace(/\s+/g,'_')}.pdf`);
    }

    // Bind Export Buttons
    document.getElementById('btnExportXLSX').addEventListener('click', ()=>{ recalcAll(); exportExcel(); });
    document.getElementById('btnExportPDF').addEventListener('click', ()=>{ recalcAll(); exportPDF(); });
    document.getElementById('btnExportXLSX_mb').addEventListener('click', ()=>{ recalcAll(); exportExcel(); });
    document.getElementById('btnExportPDF_mb').addEventListener('click', ()=>{ recalcAll(); exportPDF(); });

    // Icons
    lucide.createIcons();
    
  </script>
</body>
</html>

